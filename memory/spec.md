# アプリ概要仕様書（spec）

## 1. アプリ概要
本アプリ「Support Nav Pro」は、コールセンターのサポート業務を支援するためのナビゲーションツールである。フローチャート形式で対応スクリプトを表示し、電話帳機能や定型文コピー機能を通じてオペレーターの業務効率化と品質均一化を図るSPA（Single Page Application）である。

## 2. 本アプリの目的
- 複雑なサポート対応フローの標準化と、オペレーターへのリアルタイムナビゲーションの提供。
- 対応スクリプトや案内テンプレートの一元管理による、回答品質の均一化。
- 頻繁に使用する連絡先や迷惑電話情報の共有による業務効率向上。
- Googleスプレッドシート連携による、エンジニアを介さないデータメンテナンスサイクルの確立。

## 3. 主な利用者
- **コールセンター・オペレーター**: 顧客対応中にスクリプトを参照したり、電話番号を検索したりする実務担当者。
- **管理者・SV**: 対応フローの策定、電話帳データの更新、スプレッドシートでのマスタデータ管理を行う運用担当者。

## 4. 主な機能（高レベル）
- **フローチャートナビゲーション**: 階層化された選択肢（カテゴリ）を辿り、最終的な回答（スクリプト・テンプレート）を表示する機能。
- **回答・定型文表示**: オペレーターが読み上げるスクリプトや、メール/チャット用のテンプレートを表示・コピーする機能。資料送付時のテンプレート自動生成も含む。
- **電話番号管理・検索**: 安全/注意/危険のステータス付きで電話番号をデータベース化し、検索可能にする機能。
- **データ同期・永続化**: 
    - Googleスプレッドシート（CSV）からのデータインポート機能。
    - **日本語カラム・自動ID管理**: システム内部で `タイトル_行番号` 形式のIDを自動生成し、タイトルの重複を許容する。`親カテゴリ` 列で階層を定義する直感的な管理方式を採用。
    - マスタシートによる色・アイコン定義の柔軟なマッピング。
- **編集モード**: アプリ画面上でのノード追加・編集・削除（スプレッドシート非連携時のみ有効）。

## 5. システム構造
- **UI層**: React (TypeScript) + Tailwind CSS。
- **ロジック層**: `App.tsx`を中心とした状態管理。`sync.ts`にて日本語CSVヘッダーの解析と階層構造への変換、重複チェックを行う。
- **データ層**: 
    - `data.ts`: アプリ初期データ（静的定義）。商材データ等はここに固定。
    - `Google Sheets`: 
        - **Dataシート (管理リスト)**: フローチャート構造とコンテンツを定義。
        - **Masterシート (マスタ)**: 色やアイコンの変換ルールを定義。
        - **Phoneシート**: 電話帳データを定義。
- **memory層（本フォルダ）**: 仕様、ルール、変更履歴を管理。

## 6. データ構造詳細 (Spreadsheet)
### A. Dataシート (管理リスト)
- **タイトル (必須)**: ノードの表示名。**重複可能**（システムが自動で一意なIDを付与する）。
- **親カテゴリ**: 親ノードのタイトルを指定。空欄または「root」でルート階層へ配置。**注意**: 親として指定される項目のタイトルは重複してはならない（重複した場合、どちらの下に配置するか一意に定まらないためエラーとなる）。
- **本文**: スクリプト内容。
- **テンプレート**: コピー用定型文。
- **色 / アイコン**: 日本語名で指定可能（マスタシートで変換）。

### B. Masterシート (マスタ)
- **ラベル**: 日本語の名称（例：青、電話）。
- **値**: システム用コード（例：bg-blue-500, Phone）。

## 7. 開発で守るべき原則
1. 既存ロジックを破壊しない
2. 既存のキー名・ID・データ構造を変更しない
3. 改修は最小差分で行う
4. 本番挙動に影響を与える変更は慎重に行う
5. 変更があれば必ず memory を更新する